const folders = [
  {
    name: { vi: 'Thiết kế', en: 'Design' },
    images: [
      {
        src: 'https://drive.google.com/file/d/1Aiv7dAXU96iR_7sKvFsNyKqHH0OwzXe8/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1QCdYhXSq_fIjsYdyL1311uqP3J2gk5ig/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1oADi3YwiKYpFTrpL-WvWJLfeyo2_gXZN/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1v-Vg_DMt7ICKSfxnCxTZ4kbjiLf02Eb1/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1KZ8knMyWuJna5d1JU-JgVCEwJ0NZaH0f/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1FY0NKv2JBSNcpVsgjT0YH2LZf_qK-Lfs/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      }
    ]
  },
  {
    name: { vi: 'Ảnh giao hàng', en: "Order delivery photos" },
    images: [
      {
        src: 'https://drive.google.com/file/d/194-xF3Yn8FBIbuKerxysTpZuKaCaQuyh/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/19BBqIXNgty0LQaDT6p3Vv-R9YX606Mdn/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/190vN27gRPGbkaDx9BPisVVzXTEzk9dQA/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/190azToVcjtVs3c7bgLuZlwODC8pN6_re/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/19-E0v4Z9lcUdQsjyG5-c3M4_SNSf61z8/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18xyy4AWPslqJTPsDc0c0q7uG2nN4hPQy/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18vc9hP4jEb_23YP49ooA-Meo57fiue5W/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18sTfQG63Szckq34m1UVFmXUtbNmTQhjU/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18hotILzMW1QmzAougQZMwmYqIgfx6fk5/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18a_3ZjvP_uc8dYHp8o6OfSXUrqPceAbo/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18WxTN8qFqzQA1NzXM3gfiRV7PaD_hyLn/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18QXbgD8UIFP6L1vVg6xyM-9rpAUZl30B/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18HCq9v3J-57bZ7eaWGhQDFGC-1uz9NUT/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18EyHGPSkwWAp2h_Gci8RT1tKbVCS19sP/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18C7yGFoWSCaUPn4j7IfrP3_3MyOexiT9/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18BCulLMNVhVFPjFxn0qTfteLS8cBmBjW/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18Ar8ERfM_C45hRQJItTPSn_KXvMYDPhL/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/18ABUWz-DklWoxrfFuR_7_39Th8MUBKXy/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17w98qMoVnmrFRgrCvKfT_ZoaKCflg6Nu/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17rS1ov7Q0bL6vXxBSvZ0DQ0rKAtcnIZC/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17l8EzpgnOInT-3Ode4fGZxoKt_AAMM88/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17jbcQXb-f83m_ksPxDFBCYSP1HrPiYMc/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17j1Xd-VCAjfkVcgk2GDVDK2OEs3jP676/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17dIyfLgyiNzj8frHc8nnZ9RLEenoo6kH/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17Y8fZMcXfwbekUHnIAKA9ASIvz1t-dQf/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17aQtBwI9Ejhf5QX6BNyXy0FvnLmkMXMO/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16WU0s7EMrYsv21LrY3urvV1ILl-dz-RK/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17Tph4CqqYRsYZ9BHpSc57rcAJRJ25Fio/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16Qcs6wqKhWUBP-hg6Xlxy4p52y2H-Unk/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17SNqZvM3t1EC4bpSymGKBlFmKRT_bAQe/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/17JcLga7dIxrH78-KMM6V_IseH_IKEK44/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/174OPb2iPMDWhMbmqgaIjayed_akHiIyS/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/173ttOVTeCUXc7uNo7TiEuxSaMLyAtL8J/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16wR50o7etxhJAN7Xg5F-42mXqO6ykSdU/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16w8fWRPTfIScLGp8wsVSh1Z-4PtwaJ9u/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16uqlDDJhorAvG0q9xyb3u-vWd_cJ9suO/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16uE7pskxB-V8OHpspQNHFJjAKFoEDF3T/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16s-JlN2L-nNkvl13cQlMkvQ0CJGNRP7I/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16ovdF7QEJqHJ4h_UOyt759Uh5UD6UCdC/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16g1uxvCcT8LZg45l0OZev0Bo_I2KhHHb/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16giWHLVablGYO6x36XGuMNFLuMn9gIV6/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/16O9ToLgtDWtjPt64Jls1BRh9CYq3N2Io/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1tJA4It1VhFm9nfP7ORWadg36L6uxvAb9/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1wNeSiYiONY6vgXwFe0UHj0rR2af8rNZI/view?usp=sharing',
        short: 'Sketch',
        desc: 'This is a sketch project',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1B90EsO6D_7YRf2MOSvdH6tUq-72b-AbR/view?usp=sharing',
        short: 'Logo',
        desc: 'This is a logo design',
        type: 'drive'
      },
      {
        src: 'https://drive.google.com/file/d/1hMEWXYFK8X4WNIfLQ1cdwXzExpg88-wa/view?usp=sharing',
        short: 'UX Flow',
        desc: 'User experience workflow',
        type: 'drive'
      },
    ]
  },
  {
    name: { vi: 'Móc khoá', en: 'Keychain' },
    images: [
     
      
    
      {
        type: 'card3d',
        short: 'Haerin',
        desc: 'Haerin',
        front: '../image/keychain/Felina.png',
        back: '../image/keychain/Felina.png'
      },
      {
        type: 'card3d',
        short: 'Hanni',
        desc: 'Hanni',
        front: '../image/keychain/Felix.png',
        back: '../image/keychain/Felix.png'
      }
    ]
  },
  {
      name: { vi: 'Bài trình chiếu dự án', en: 'Project slide' },
      images: [
        {
          src: 'https://www.canva.com/design/DAGoiZj0_nQ/v_5sgNYbtQEfdhYaRyWIUw/view?embed',
          short: 'Project slide',
          desc: 'Bài thuyết trình bằng Canva',
          type: 'iframe'
        },
        
       
      ]
    }
];

let currentOpen = null;
let currentFolder = null;

function createGallery(folderData) {
  const images = folderData.images || [];
  const wrapper = document.createElement('div');
  wrapper.className = 'gallery-wrapper';

  const gallery = document.createElement('div');
  gallery.className = 'gallery';

  const leftArrow = document.createElement('span');
  leftArrow.className = 'arrow';
  leftArrow.innerHTML = '&#9664;';

  const rightArrow = document.createElement('span');
  rightArrow.className = 'arrow';
  rightArrow.innerHTML = '&#9654;';

 const viewer = document.createElement('div');
viewer.className = 'image-viewer';

const hasIframeOrCard3D = images.some(img => img.type === 'iframe' || img.type === 'card3d');
const hasCard3D = images.some(img => img.type === 'card3d');

if (hasIframeOrCard3D) {
  viewer.style.justifyContent = 'center';
}
function adjustViewerStyle() {
  if (hasCard3D && window.innerWidth <= 400) {
    viewer.style.justifyContent = ''; // reset lại
  } else if (hasIframeOrCard3D) {
    viewer.style.justifyContent = 'center';
  }
}

// Gọi lần đầu khi tạo
adjustViewerStyle();

// Theo dõi khi resize
window.addEventListener('resize', adjustViewerStyle);
  const desc = document.createElement('div');
  desc.className = 'description';

  leftArrow.onclick = () => scrollImages(-1, viewer);
  rightArrow.onclick = () => scrollImages(1, viewer);

  images.forEach((imgObj) => {
    const box = document.createElement('div');
    box.className = 'image-box';
    let media;

    if (imgObj.type === 'video') {
      media = document.createElement('video');
      media.src = imgObj.src;
      media.controls = true;
      media.onclick = () => desc.textContent = imgObj.desc;
      box.appendChild(media);
    } else if (imgObj.type === 'drive') {
      const previewLink = imgObj.src.replace('/view?usp=sharing', '/preview');
      const iframeWrapper = document.createElement('div');
      iframeWrapper.className = 'drive-portrait-wrapper';

      media = document.createElement('iframe');
      media.src = previewLink;
      media.allow = 'autoplay';
      media.frameBorder = 0;
      media.allowFullscreen = true;

      iframeWrapper.appendChild(media);
      iframeWrapper.onclick = () => desc.textContent = imgObj.desc;
      box.appendChild(iframeWrapper);
    } else if (imgObj.type === 'card3d') {
      const cardScene = document.createElement('div');
      cardScene.className = 'scene';
    
      const card = document.createElement('div');
      card.className = 'card card3D';
    
      const front = document.createElement('div');
      front.className = 'face front';
      const imgFront = document.createElement('img');
      imgFront.src = imgObj.front;
      front.appendChild(imgFront);
    
      const back = document.createElement('div');
      back.className = 'face back';
      const imgBack = document.createElement('img');
      imgBack.src = imgObj.back;
      back.appendChild(imgBack);
    
      card.appendChild(front);
      card.appendChild(back);
      cardScene.appendChild(card);
    
      box.appendChild(cardScene); // <- cái này phải chắc chắn thêm vào
      box.onclick = () => desc.textContent = imgObj.desc;
    
      viewer.appendChild(box); // <- phải luôn thêm box vào viewer
      setupCard3DRotation(card); // <- setup xoay
      return; // <- thoát ra luôn nếu là 3dcard
    
    }  else if (imgObj.type === 'iframe') {
  const iframeWrapper = document.createElement('div');
  iframeWrapper.className = 'iframe-wrapper';

  media = document.createElement('iframe');
  media.src = imgObj.src;
  media.frameBorder = 0;
  media.allowFullscreen = true;
  media.loading = 'lazy';

  iframeWrapper.appendChild(media);
  iframeWrapper.onclick = () => desc.textContent = imgObj.desc;
  box.appendChild(iframeWrapper);
}
    else {
      media = document.createElement('img');
      media.src = imgObj.src;
      media.alt = imgObj.short;
      media.onclick = () => desc.textContent = imgObj.desc;
      box.appendChild(media);
    }


    viewer.appendChild(box);
  });

  gallery.appendChild(leftArrow);
  gallery.appendChild(viewer);
  gallery.appendChild(rightArrow);
  wrapper.appendChild(gallery);
  wrapper.appendChild(desc);

  return wrapper;
}

function scrollImages(direction, viewer) {
  const scrollAmount = viewer.querySelector('.image-box')?.offsetWidth + 10 || 190;
  viewer.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
}

function loadFolders() {
  const folderList = document.getElementById('folder-list');
  folderList.innerHTML = '';
  currentOpen = null;
  currentFolder = null;

  folders.forEach(folderData => {
    const folder = document.createElement('div');
    folder.className = 'folder';
    folder.innerHTML = `
      <span class="lang vi">${folderData.name.vi}</span>
      <span class="lang en" style="display:none">${folderData.name.en}</span>
    `;

    folder.onclick = () => {
      if (currentFolder === folder) {
        currentOpen.classList.remove('open');
        const toRemove = currentOpen;
        currentOpen = null;
        currentFolder = null;
        setTimeout(() => folderList.removeChild(toRemove), 500);
        return;
      }

      if (currentOpen) {
        currentOpen.classList.remove('open');
        const toRemove = currentOpen;
        currentOpen = null;
        currentFolder = null;
        setTimeout(() => folderList.removeChild(toRemove), 500);
      }

      const galleryWrapper = createGallery(folderData);
      folderList.insertBefore(galleryWrapper, folder.nextSibling);
      setTimeout(() => galleryWrapper.classList.add('open'), 10);
      currentOpen = galleryWrapper;
      currentFolder = folder;
    };

    folderList.appendChild(folder);
  });
}

function toggleLanguage() {
  const htmlLang = document.documentElement.lang;
  const newLang = htmlLang === 'vi' ? 'en' : 'vi';
  document.documentElement.lang = newLang;

  document.querySelectorAll('.lang.vi').forEach(el => el.style.display = newLang === 'vi' ? 'inline' : 'none');
  document.querySelectorAll('.lang.en').forEach(el => el.style.display = newLang === 'en' ? 'inline' : 'none');

  const flag = document.getElementById('flagIcon');
  if (flag) {
    flag.src = newLang === 'vi'
      ? 'https://flagcdn.com/w40/vn.png'
      : 'https://flagcdn.com/w40/us.png';
  }
}

function setupCard3DRotation(card) {
  let rotationX = 0;
  let rotationY = 0;
  let autoRotate = true;
  let lastManualTime = 0;
  let isDragging = false;
  let startX = 0, startY = 0;

  function updateRotation() {
    card.style.transform = `rotateX(${rotationX}deg) rotateY(${rotationY}deg)`;
  }

  setInterval(() => {
    const now = Date.now();
    if (autoRotate && now - lastManualTime > 3000) {
      rotationY += 0.5;
      updateRotation();
    }
  }, 30);

  function startDrag(x, y) {
    isDragging = true;
    startX = x;
    startY = y;
    autoRotate = false;
    lastManualTime = Date.now();
  }

  function drag(x, y) {
    if (!isDragging) return;
    const dx = x - startX;
    const dy = y - startY;
    startX = x;
    startY = y;
    rotationY += dx * 0.5;
    rotationX -= dy * 0.5;
    rotationX = Math.max(-90, Math.min(90, rotationX));
    updateRotation();
    lastManualTime = Date.now();
  }

  function stopDrag() {
    isDragging = false;
    lastManualTime = Date.now();
    autoRotate = true;
  }

  card.addEventListener('mousedown', e => startDrag(e.clientX, e.clientY));
  document.addEventListener('mousemove', e => drag(e.clientX, e.clientY));
  document.addEventListener('mouseup', stopDrag);

  card.addEventListener('touchstart', e => {
    const touch = e.touches[0];
    startDrag(touch.clientX, touch.clientY);
  });
  card.addEventListener('touchmove', e => {
    const touch = e.touches[0];
    drag(touch.clientX, touch.clientY);
  });
  card.addEventListener('touchend', stopDrag);
}

document.getElementById('langToggle').onclick = toggleLanguage;
loadFolders();